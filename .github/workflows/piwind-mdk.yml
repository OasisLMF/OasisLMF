#  ==============================================================================
#  Workflow description:
#    Runs the command line interface of OasisLMF package on the PiWind model.
#    Multiple versions of python are tested and be extending via
#    the `py-version` test matrix.
#
#    Loss results are not checked and the workflow should only fail on:
#      1. Package installation failure when pip installing 'oasislmf'
#      2. An invocation error or python exception when executing 'oasislmf model run ..'
#      3. Empty files are produced (either input files / or results)
#  ==============================================================================

name: PiWind MDK

on:
  push:
  workflow_dispatch:
    inputs:
      build_branch:
        description: 'Branch of build script repo - https://github.com/OasisLMF/build'
        required: true
        default: master
      piwind_branch:
        description: 'Branch to run PiWind from'
        required: true
        default: develop
      mdk_run_type:
        description: 'Loss modes to test, options are one of "[gul, il, ri]"'
        required: true
        default: ri

env:
  BUILD_BRANCH: "${{ github.event_name == 'workflow_dispatch' && github.event.inputs.build_branch || 'master' }}"
  PIWIND_BRANCH: "${{ github.event_name == 'workflow_dispatch' && github.event.inputs.piwind_branch || 'hotfix/ghactions-reusable-workflow' }}"
  MDK_RUN: "${{ github.event_name == 'workflow_dispatch' && github.event.inputs.mdk_run_type || 'ri' }}"

jobs:
  run_piwind_mdk:
    uses: OasisLMF/OasisPiWind/.github/workflows/run_mdk.yml@${{ env.BUILD_BRANCH }}
    with:
      build_branch: ${{ env.BUILD_BRANCH }}
      mdk_branch: ${{ github.ref_name }}
      mdk_run_type: ${{ env.MDK_RUN }}
